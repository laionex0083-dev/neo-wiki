# Neo-Wiki 🌳

**Namulike 문법을 지원하는 현대적인 위키 엔진**

Neo-Wiki는 나무위키 스타일의 문법을 지원하면서도 현대적인 UI/UX를 제공하는 위키 엔진입니다. React + Express.js 기반으로 제작되어 빠른 속도와 반응형 디자인을 자랑합니다.

## ✨ 주요 기능

### 📝 문서 관리
- **Namulike 파서**: `[[링크]]`, `{{{문법}}}`, 각주 등 나무위키 전용 문법 완벽 지원
- **실시간 미리보기**: 편집 중 실시간으로 렌더링 결과 확인
- **문서 히스토리**: 모든 편집 내역 저장 및 리비전 비교
- **역링크**: 해당 문서를 참조하는 모든 문서 목록 조회
- **리다이렉트**: `#redirect '문서명'` 문법으로 문서 리다이렉트 설정
- **템플릿(틀)**: `[include(틀:템플릿명)]` 문법으로 템플릿 삽입
- **편집자 ID 표시**: 문서 히스토리 및 최근 변경에서 편집자 확인 가능

### 📂 분류 시스템
- **분류 태그**: `[[분류:카테고리명]]` 문법으로 문서 분류
- **분류 페이지**: 특정 분류에 속한 문서 목록 자동 생성
- **분류 목록**: 전체 분류를 한글 초성/알파벳순으로 그룹화하여 표시
- **계층 구조**: `분류:상위/하위` 형식으로 하위 분류 지원
- **정렬 옵션**: 이름순, 최근 수정순, 생성순 정렬

### 💬 코멘트 시스템
- **문서별 코멘트**: 각 문서에 댓글 작성 가능
- **수정/삭제**: 본인 작성 코멘트 또는 모더레이터 이상 권한으로 관리
- **로그인 모달**: 비로그인 상태에서도 편리하게 로그인 후 댓글 작성 가능

### 🎨 테마 및 UI
- **다양한 스킨**: 기본, 다크, RDL, RDL-Dark, 303 Corsair 등 다양한 테마
- **브라우저별 스킨 설정**: localStorage 기반 개별 스킨 설정
- **반응형 디자인**: 모바일/태블릿/데스크톱 최적화
- **모바일 하단 네비게이션**: [대문] [목차] [문서] [도구] [설정]
- **모바일 Bottom Sheet**: 목차 및 도구 메뉴를 하단 슬라이드 패널로 표시
- **플로팅 버튼**: 데스크탑에서 목차/맨 위/맨 아래 이동 버튼 제공
- **자동 목차**: 문서 내 제목 자동 추출 및 접기/펼치기 기능

### 🔐 사용자 관리 및 권한
- **회원가입/로그인**: JWT 기반 인증 시스템
- **6단계 권한 체계**:
  - `guest`: 문서 열람만 가능
  - `user`: 로그인한 일반 사용자
  - `verified`: 인증된 사용자 (문서 편집 가능)
  - `moderator`: 모더레이터 (이미지 업로드, 문서 되돌리기 가능)
  - `admin`: 관리자 (파일 삭제, 원본 이미지 다운로드 가능)
  - `owner`: 오너 (모든 권한)
- **IP 차단**: 관리자가 특정 IP 차단 가능
- **Rate Limiting**: API 요청 제한으로 서버 보호

### 🖼️ 이미지 업로드 및 보안
- **보안 강화**: 파일 시그니처(매직넘버) 검증으로 확장자 위조 방지
- **자동 처리**: Sharp 라이브러리로 EXIF 제거 및 WebP 변환
- **워터마크**: 업로드 시 "SAMPLE" 워터마크 자동 삽입 (50% 불투명도)
- **원본 보존**: 원본과 워터마크 버전을 분리 저장
- **GIF 지원**: 애니메이션 GIF는 워터마크 미적용
- **원본 다운로드**: 관리자 이상만 워터마크 없는 원본 다운로드 가능
- **드래그 앤 드롭**: 편리한 이미지 업로드 UI

### 🛠️ 도구
- **🎲 주사위 시뮬레이터**: Obsidian Protocol 전투 시뮬레이터 내장
- **📋 로스터 빌더**: 외부 로스터 빌더 링크
- **🤖 AmadeusEmber**: 외부 도구 링크
- **자동완성 검색**: 문서 제목 실시간 자동완성

### 🔗 외부 링크
- **라쿤펀치 블로그**: 공식 블로그 바로가기
- **라쿤펀치 스토어**: 스마트스토어 바로가기
- **Queti Techtonics**: 관련 사이트 링크

## 🔧 기술 스택

### Backend
- **Node.js + Express.js**: REST API 서버
- **Better-SQLite3**: 고성능 동기식 SQLite 데이터베이스
- **JWT**: 사용자 인증
- **Sharp**: 이미지 처리 및 워터마크
- **File-Type**: 파일 시그니처 검증
- **Multer**: 파일 업로드 처리
- **Helmet + Rate Limiting**: 보안 강화

### Frontend  
- **React 18 + Vite**: 빠른 SPA
- **React Router v6**: 클라이언트 라우팅
- **Vanilla CSS**: 커스텀 스킨 시스템
- **Bottom Sheet UI**: 모바일 최적화 인터페이스

### 지원 플랫폼
- ✅ Windows
- ✅ macOS  
- ✅ Linux
- ✅ **라즈베리 파이** (ARM32/ARM64)

## 📁 프로젝트 구조

```
neo-wiki/
├── backend/                    # Express.js API 서버
│   ├── src/
│   │   ├── routes/            # API 라우트
│   │   │   ├── pages.js       # 문서 CRUD + 리다이렉트
│   │   │   ├── users.js       # 사용자 관리 및 권한
│   │   │   ├── skins.js       # 스킨 관리
│   │   │   ├── upload.js      # 이미지 업로드 + 워터마크
│   │   │   ├── history.js     # 문서 히스토리
│   │   │   ├── categories.js  # 분류 시스템
│   │   │   └── comments.js    # 코멘트 시스템
│   │   ├── parser/            # Namulike 파서
│   │   │   └── namulike.js    # 핵심 파서 엔진
│   │   ├── database/          # 데이터베이스
│   │   │   └── init.js        # DB 초기화 스키마
│   │   └── app.js             # Express 앱
│   ├── uploads/               # 업로드된 파일
│   │   ├── originals/         # 원본 이미지
│   │   └── watermarked/       # 워터마크 이미지
│   └── package.json
│
├── frontend/                   # React SPA
│   ├── src/
│   │   ├── components/        # UI 컴포넌트
│   │   │   ├── Header.jsx
│   │   │   ├── Sidebar.jsx
│   │   │   ├── MobileBottomNav.jsx
│   │   │   ├── MobileSearchBar.jsx
│   │   │   ├── FloatingScrollButtons.jsx
│   │   │   ├── CommentSection.jsx
│   │   │   └── DiceSimulator.jsx
│   │   ├── pages/             # 페이지 컴포넌트
│   │   │   ├── PageView.jsx   # 문서 보기
│   │   │   ├── PageEdit.jsx   # 문서 편집
│   │   │   ├── PageHistory.jsx # 문서 히스토리
│   │   │   ├── CategoryPage.jsx # 분류 페이지
│   │   │   ├── CategoryListPage.jsx # 분류 목록
│   │   │   ├── UploadPage.jsx # 파일 업로드
│   │   │   ├── DiceSimulatorPage.jsx
│   │   │   └── AdminPage.jsx
│   │   └── App.jsx
│   └── package.json
│
├── docker-compose.yml
└── README.md
```

## 🚀 빠른 시작

```bash
# 1. 의존성 설치
cd backend && npm install
cd ../frontend && npm install

# 2. 백엔드 서버 시작 (포트 3001)
cd backend && npm run dev

# 3. 프론트엔드 시작 (포트 5173)
cd frontend && npm run dev
```

브라우저에서 `http://localhost:5173` 접속

## 📖 Namulike 문법

### 기본 서식
| 문법 | 설명 | 예시 |
|------|------|------|
| `[[문서명]]` | 내부 링크 | `[[대문]]` |
| `[[문서명\|표시]]` | 링크 표시문구 | `[[나무위키\|위키]]` |
| `'''굵게'''` | 굵은 글씨 | `'''강조'''` |
| `''기울임''` | 기울인 글씨 | `''이탤릭''` |
| `~~취소~~` | 취소선 | `~~삭제~~` |
| `__밑줄__` | 밑줄 | `__강조__` |

### 블록 문법
| 문법 | 설명 | 예시 |
|------|------|------|
| `{{{코드}}}` | 인라인 코드 | `{{{inline}}}` |
| `{{{#!syntax 언어}}}` | 코드 블록 | 여러 줄 코드 |
| `{{{#!folding 제목}}}` | 접기/펼치기 | 콘텐츠 접기 |
| `= 제목 =` | 제목 (1~6) | `== 소제목 ==` |
| `> 인용` | 인용문 | `> 인용글` |
| `----` | 수평선 | `----` |

### 목록
| 문법 | 설명 |
|------|------|
| ` * 항목` | 글머리 기호 목록 |
| ` 1. 항목` | 번호 목록 |
| `  * 항목` | 들여쓰기로 중첩 가능 |

### 특수 문법
| 문법 | 설명 |
|------|------|
| `[* 각주]` | 각주 |
| `[include(틀:이름)]` | 템플릿 삽입 |
| `[[분류:이름]]` | 분류 태그 |
| `#redirect '문서명'` | 리다이렉트 |
| `[youtube(동영상ID)]` | YouTube 삽입 |
| `[br]` | 줄바꿈 |
| `[[파일:이미지.jpg]]` | 이미지 삽입 |

## 📱 반응형 레이아웃

### 데스크톱 (1024px 이상)
- 좌측 사이드바 표시 (접기 가능한 '둘러보기' 메뉴)
- 헤더에 전체 검색창
- 우측 하단 플로팅 버튼 (목차/맨 위/맨 아래)

### 모바일 (768px 이하)
- 사이드바 숨김
- 헤더 아래 검색 바 고정
- 하단 네비게이션 바 (대문/목차/문서/도구/설정)
- Bottom Sheet 방식 목차 및 도구 메뉴
- 우측 하단 플로팅 버튼

## 🔒 보안 기능

- **파일 업로드 보안**: 매직넘버 검증으로 확장자 위조 방지
- **이미지 재인코딩**: EXIF 메타데이터 자동 제거
- **워터마크**: 업로드 이미지에 자동으로 워터마크 삽입
- **권한 기반 접근 제어**: 6단계 세밀한 권한 관리
- **Rate Limiting**: API 요청 횟수 제한
- **Helmet**: HTTP 헤더 보안 강화
- **JWT 인증**: 안전한 사용자 인증

## 🍓 라즈베리 파이 배포

```bash
# 자동 설치 (권장)
chmod +x install.sh
./install.sh

# 또는 수동 설치
cd backend && npm install --production
cd ../frontend && npm install && npm run build

# systemd 서비스로 등록
sudo systemctl enable neo-wiki
sudo systemctl start neo-wiki
```

자세한 내용은 [라즈베리 파이 배포 가이드](docs/RASPBERRY_PI.md)를 참조하세요.

## 🐳 Docker 배포

```bash
docker-compose up -d
```

## 🌐 SEO 최적화

- **robots.txt**: 메인 페이지만 크롤링 허용
- **메타 태그**: 각 페이지별 적절한 메타 정보
- **시맨틱 HTML**: 의미있는 HTML5 태그 사용

## 📄 라이선스

MIT License

---

**Neo-Wiki** - 현대적인 위키 엔진 🌳
